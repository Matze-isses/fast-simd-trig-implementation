import matplotlib.pyplot as plt
import numpy as np


f = [
    (0, 0.062581514653069270),
    (1, 0.066504041366509323),
    (2, 0.070428609692016197),
    (3, 0.074355326288626622),
    (4, 0.078284328171867645),
    (5, 0.082215741884160920),
    (6, 0.086149683804976465),
    (7, 0.090086264715054348),
    (8, 0.094025618794392307),
    (9, 0.097967872990207469),
    (10, 0.10191314412628683),
    (11, 0.10586157322406496),
    (12, 0.10981324394542859),
    (13, 0.11376832451560036),
    (14, 0.11772689570065152),
    (15, 0.12168913627142748),
    (16, 0.12565514267916725),
    (17, 0.12962502356398889),
    (18, 0.13359895575504030),
    (19, 0.13757702383800771),
    (20, 0.14155935424195701),
    (21, 0.14554611828351402),
    (22, 0.14953740284447911),
    (23, 0.15353334871973143),
    (24, 0.15753410865629811),
    (25, 0.16153977751528725),
    (26, 0.16555052858691274),
    (27, 0.16956643653285033),
    (28, 0.17358768905905048),
    (29, 0.17761439773375770),
    (30, 0.18164669843275025),
    (31, 0.18568473153069032),
    (32, 0.18972860252954629),
    (33, 0.19377849688676124),
    (34, 0.19783451076628308),
    (35, 0.20189681941123350),
    (36, 0.20596552334148061),
    (37, 0.21004076831770072),
    (38, 0.21412272850586631),
    (39, 0.21821152273176467),
    (40, 0.22230728897765503),
    (41, 0.22641015767643102),
    (42, 0.23052031262798994),
    (43, 0.23463787504942282),
    (44, 0.23876298538340368),
    (45, 0.24289578604842277),
    (46, 0.24703645572597596),
    (47, 0.25118511157008583),
    (48, 0.25534192722010252),
    (49, 0.25950703585571716),
    (50, 0.26368060158461432),
    (51, 0.26786276968758632),
    (52, 0.27205369005605318),
    (53, 0.27625355058013035),
    (54, 0.28046246912929901),
    (55, 0.28468061635026731),
    (56, 0.28890817143191849),
    (57, 0.29314527060948226),
    (58, 0.29739209296611357),
    (59, 0.30164878069522905),
    (60, 0.30591551339770340),
    (61, 0.31019245422893899),
    (62, 0.31447979412236204),
    (63, 0.31877766469257712),
    (64, 0.32308624047502715),
    (65, 0.32740572061429157),
    (66, 0.33173625513227356),
    (67, 0.33607803150826154),
    (68, 0.34043122014697624),
    (69, 0.34479602263726822),
    (70, 0.34917256383286360),
    (71, 0.35356109539024133),
    (72, 0.35796174933211927),
    (73, 0.36237472326835252),
    (74, 0.36680020660719226),
    (75, 0.37123838039523954),
    (76, 0.37568946155389976),
    (77, 0.38015362623141458),
    (78, 0.38463107495394139),
    (79, 0.38912199069326631),
    (80, 0.39362658161603165),
    (81, 0.39814503092812237),
    (82, 0.40267757274600063),
    (83, 0.40722438778280495),
    (84, 0.41178571006442827),
    (85, 0.41636171910391528),
    (86, 0.42095263438670671),
    (87, 0.42555867790022917),
    (88, 0.43018004963767253),
    (89, 0.43481697858270180),
    (90, 0.43946969285837467),
    (91, 0.44413840356454981),
    (92, 0.44882336491191971),
    (93, 0.45352477197959234),
    (94, 0.45824283791225401),
    (95, 0.46297786096715859),
    (96, 0.46773002552835319),
    (97, 0.47249958854968721),
    (98, 0.47728680392371964),
    (99, 0.48209187460470648),
    (100, 0.48691509636370672),
    (101, 0.49175669911921549),
    (102, 0.49661693308476496),
    (103, 0.50149606990953821),
    (104, 0.50639436900757484),
    (105, 0.51131205468643959),
    (106, 0.51624945920289456),
    (107, 0.52120678961605826),
    (108, 0.52618435459619806),
    (109, 0.53118241912498698),
    (110, 0.53620127645140858),
    (111, 0.54124120521780816),
    (112, 0.54630248534717762),
    (113, 0.55138541729130786),
    (114, 0.55649028839717141),
    (115, 0.56161740665790894),
    (116, 0.56676705912692549),
    (117, 0.57193958685047352),
    (118, 0.57713525286970402),
    (119, 0.58235440912703562),
    (120, 0.58759737507805077),
    (121, 0.59286445200563542),
    (122, 0.59815599208217651),
    (123, 0.60347230069878444),
    (124, 0.60881374653809917),
    (125, 0.61418064134180517),
    (126, 0.61957336535046581),
    (127, 0.62499224997686109),
    (128, 0.63043766497548992),
    (129, 0.63590997662293458),
    (130, 0.64140954079815604),
    (131, 0.64693670108545298),
    (132, 0.65249190902434340),
    (133, 0.65807548677541905),
    (134, 0.66368782182183994),
    (135, 0.66932936776824015),
    (136, 0.67500048115228506),
    (137, 0.68070158339757514),
    (138, 0.68643308076654508),
    (139, 0.69219541158818731),
    (140, 0.69798895460546884),
    (141, 0.70381420553627205),
    (142, 0.70967158070190683),
    (143, 0.71556150606099211),
    (144, 0.72148445559503904),
    (145, 0.72744088002388063),
    (146, 0.73343124112539881),
    (147, 0.73945604664571274),
    (148, 0.74551574925472319),
    (149, 0.75161085637179714),
    (150, 0.75774185078448841),
    (151, 0.76390923939968591),
    (152, 0.77011355012057492),
    (153, 0.77635531003994362),
    (154, 0.78263505075976059),
    (155, 0.78895327491210410),
    (156, 0.79531060328148451),
    (157, 0.80170751445770450),
    (158, 0.80814463767982636),
    (159, 0.81462254740271312),
    (160, 0.82114181074857517),
    (161, 0.82770300884387638),
    (162, 0.83430679260030449),
    (163, 0.84095374645000398),
    (164, 0.84764453870302359),
    (165, 0.85437974024774777),
    (166, 0.86116008483069162),
    (167, 0.86798619279170286),
    (168, 0.87485874841530609),
    (169, 0.88177845144970990),
    (170, 0.88874596129600447),
    (171, 0.89576206028166194),
    (172, 0.90282738447243593),
    (173, 0.90994274826458355),
    (174, 0.91710886559036109),
    (175, 0.92432651941447652),
    (176, 0.93159646697040344),
    (177, 0.93891950692020931),
    (178, 0.94629650510584595),
    (179, 0.95372821775310024),
    (180, 0.96121551819624862),
    (181, 0.96875926157901260),
    (182, 0.97636029168286009),
    (183, 0.98401953178216994),
    (184, 0.99173789210653507),
    (185, 0.99951630587848861)
]

g = [
    (0, 15.979159429803856),
    (1, 15.036680169388752),
    (2, 14.198775247346111),
    (3, 13.448935670301266),
    (4, 12.773948801151764),
    (5, 12.163120797583566),
    (6, 11.607703659873847),
    (7, 11.100471344472224),
    (8, 10.635399296724863),
    (9, 10.207427899347744),
    (10, 9.8122769989397902),
    (11, 9.4462983077288634),
    (12, 9.1063697243744794),
    (13, 8.7897928026783596),
    (14, 8.4942356973612601),
    (15, 8.2176604308333747),
    (16, 7.9582894792716914),
    (17, 7.7145598319320952),
    (18, 7.4850884451039050),
    (19, 7.2686555654632139),
    (20, 7.0641746379456736),
    (21, 6.8706744761963865),
    (22, 6.6872901426542315),
    (23, 6.5132429425834859),
    (24, 6.3478316443949403),
    (25, 6.1904257600290764),
    (26, 6.0404518701068826),
    (27, 5.8973934963023691),
    (28, 5.7607771923262563),
    (29, 5.6301742018627934),
    (30, 5.5051922695430813),
    (31, 5.3854724174492405),
    (32, 5.2706865842448334),
    (33, 5.1605313079932298),
    (34, 5.0547298149683089),
    (35, 4.9530250298948504),
    (36, 4.8551815069653657),
    (37, 4.7609804896896639),
    (38, 4.6702188365426283),
    (39, 4.5827094164465576),
    (40, 4.4982780573628149),
    (41, 4.4167629679810014),
    (42, 4.3380125100462807),
    (43, 4.2618865338316141),
    (44, 4.1882538802830265),
    (45, 4.1169919670843687),
    (46, 4.0479855374432887),
    (47, 3.9811276781067471),
    (48, 3.9163172726350135),
    (49, 3.8534600678649351),
    (50, 3.7924670756604861),
    (51, 3.7332549094684562),
    (52, 3.6757450332467934),
    (53, 3.6198629769644866),
    (54, 3.5655394573987698),
    (55, 3.5127084267992910),
    (56, 3.4613074287365770),
    (57, 3.4112779575835783),
    (58, 3.3625641826124317),
    (59, 3.3151136818628495),
    (60, 3.2688763930057929),
    (61, 3.2238050486616459),
    (62, 3.1798545365712956),
    (63, 3.1369826394969680),
    (64, 3.0951488324904219),
    (65, 3.0543143782697517),
    (66, 3.0144429031468656),
    (67, 2.9754994562190471),
    (68, 2.9374509175987575),
    (69, 2.9002654739205576),
    (70, 2.8639134444671437),
    (71, 2.8283654877136719),
    (72, 2.7935945722295412),
    (73, 2.7595743736779932),
    (74, 2.7262798166057300),
    (75, 2.6936870022311497),
    (76, 2.6617728265889382),
    (77, 2.6305154837356737),
    (78, 2.5998939376381576),
    (79, 2.5698881685365125),
    (80, 2.5404788362983663),
    (81, 2.5116475714110602),
    (82, 2.4833764472668460),
    (83, 2.4556486055382192),
    (84, 2.4284475530817700),
    (85, 2.4017577844384408),
    (86, 2.3755641806516250),
    (87, 2.3498522105909134),
    (88, 2.3246080352686493),
    (89, 2.2998181976691163),
    (90, 2.2754697678828655),
    (91, 2.2515503995471602),
    (92, 2.2280479987851058),
    (93, 2.2049512215950089),
    (94, 2.1822490550119271),
    (95, 2.1599304941083028),
    (96, 2.1379854732874772),
    (97, 2.1164039593546478),
    (98, 2.0951763002436179),
    (99, 2.0742934130967354),
    (100, 2.0537461406886401),
    (101, 2.0335259322162731),
    (102, 2.0136244525301259),
    (103, 1.9940335727464102),
    (104, 1.9747454971898426),
    (105, 1.9557528339777686),
    (106, 1.9370480339950991),
    (107, 1.9186242772022213),
    (108, 1.9004745984274187),
    (109, 1.8825924277525843),
    (110, 1.8649713156559813),
    (111, 1.8476050795090084),
    (112, 1.8304877367791867),
    (113, 1.8136134337983048),
    (114, 1.7969765526012060),
    (115, 1.7805715922354195),
    (116, 1.7643932968518792),
    (117, 1.7484364135498065),
    (118, 1.7326960968467531),
    (119, 1.7171673886680552),
    (120, 1.7018455874946168),
    (121, 1.6867261928372366),
    (122, 1.6718047018454292),
    (123, 1.6570768846259563),
    (124, 1.6425384704046275),
    (125, 1.6281854762066292),
    (126, 1.6140138616745465),
    (127, 1.6000198403052561),
    (128, 1.5861996443992252),
    (129, 1.5725496324347716),
    (130, 1.5590663006908532),
    (131, 1.5457462813937826),
    (132, 1.5325860538183189),
    (133, 1.5195825100552169),
    (134, 1.5067324834362255),
    (135, 1.4940327560022091),
    (136, 1.4814804254552711),
    (137, 1.4690725339710768),
    (138, 1.4568062466967535),
    (139, 1.4446787471554883),
    (140, 1.4326874277906587),
    (141, 1.4208295202539267),
    (142, 1.4091025020488228),
    (143, 1.3975039064143890),
    (144, 1.3860312474442118),
    (145, 1.3746821596927186),
    (146, 1.3634543279961324),
    (147, 1.3523454227416964),
    (148, 1.3413532859630122),
    (149, 1.3304757262650992),
    (150, 1.3197106626283110),
    (151, 1.3090560349627984),
    (152, 1.2985098104603305),
    (153, 1.2880700203474487),
    (154, 1.2777347488196797),
    (155, 1.2675021852357584),
    (156, 1.2573703857008300),
    (157, 1.2473376910735652),
    (158, 1.2374022586736306),
    (159, 1.2275623884808144),
    (160, 1.2178164440175965),
    (161, 1.2081628184447288),
    (162, 1.1985998542374028),
    (163, 1.1891260419748324),
    (164, 1.1797398016981206),
    (165, 1.1704397387864396),
    (166, 1.1612242806128259),
    (167, 1.1520920589574142),
    (168, 1.1430416645102666),
    (169, 1.1340717142224614),
    (170, 1.1251809218258055),
    (171, 1.1163678886841464),
    (172, 1.1076314445029229),
    (173, 1.0989702395092120),
    (174, 1.0903830913860812),
    (175, 1.0818687758017151),
    (176, 1.0734261404533318),
    (177, 1.0650540250038509),
    (178, 1.0567512345278578),
    (179, 1.0485167381918425),
    (180, 1.0403494128731210),
    (181, 1.0322481958727983),
    (182, 1.0242120747008201),
    (183, 1.0162399908758799),
    (184, 1.0083309390104229),
    (185, 1.0004839281947344),
]

correction_values = [
    (0, 0.062500007059147489),
    (1, 0.066406256310472367),
    (2, 0.070312508620088865),
    (3, 0.074218749269001877),
    (4, 0.078124993480303648),
    (5, 0.082031245759342605),
    (6, 0.085937500216928572),
    (7, 0.089843745115936194),
    (8, 0.093749991622722337),
    (9, 0.097656243368730841),
    (10, 0.10156249360001111),
    (11, 0.10546875914338076),
    (12, 0.10937499970821778),
    (13, 0.11328125822416364),
    (14, 0.11718749079105407),
    (15, 0.12109374981285553),
    (16, 0.12500000600915642),
    (17, 0.12890624173616838),
    (18, 0.13281250593821872),
    (19, 0.13671875633229028),
    (20, 0.14062499132559148),
    (21, 0.14453125276561932),
    (22, 0.14843749918000254),
    (23, 0.15234374140082305),
    (24, 0.15625000129879432),
    (25, 0.16015624363194092),
    (26, 0.16406250906454695),
    (27, 0.16796874155587585),
    (28, 0.17187499445806242),
    (29, 0.17578124637080086),
    (30, 0.17968749886681873),
    (31, 0.18359375716791468),
    (32, 0.18749999209600676),
    (33, 0.19140625098295916),
    (34, 0.19531249420293290),
    (35, 0.19921875759425681),
    (36, 0.20312500431006120),
    (37, 0.20703124027229991),
    (38, 0.21093749771372980),
    (39, 0.21484375499543334),
    (40, 0.21875000802750039),
    (41, 0.22265624469947060),
    (42, 0.22656250277590337),
    (43, 0.23046875952841303),
    (44, 0.23437500965686170),
    (45, 0.23828124882417781),
    (46, 0.24218750594323674),
    (47, 0.24609375084738047),
    (48, 0.25000000563187108),
    (49, 0.25390625328993466),
    (50, 0.25781250482887791),
    (51, 0.26171875253969229),
    (52, 0.26562499199011930),
    (53, 0.26953125299046032),
    (54, 0.27343749905813403),
    (55, 0.27734374170618087),
    (56, 0.28124999906910375),
    (57, 0.28515624837874631),
    (58, 0.28906250523416838),
    (59, 0.29296875005025674),
    (60, 0.29687499638312670),
    (61, 0.30078124138828777),
    (62, 0.30468750623332957),
    (63, 0.30859375671411210),
    (64, 0.31249999648970300),
    (65, 0.31640625005028733),
    (66, 0.32031249599900596),
    (67, 0.32421874540608475),
    (68, 0.32812499249314137),
    (69, 0.33203125795705657),
    (70, 0.33593749239425674),
    (71, 0.33984375814595413),
    (72, 0.34375000929329141),
    (73, 0.34765625684439938),
    (74, 0.35156250287593382),
    (75, 0.35546874048600163),
    (76, 0.35937499265836254),
    (77, 0.36328124482395718),
    (78, 0.36718750213407486),
    (79, 0.37109375271897305),
    (80, 0.37500000492700020),
    (81, 0.37890624369175380),
    (82, 0.38281249614581375),
    (83, 0.38671874145106100),
    (84, 0.39062500276197815),
    (85, 0.39453125459466354),
    (86, 0.39843750383726351),
    (87, 0.40234375746624490),
    (88, 0.40625000183404375),
    (89, 0.41015624585428201),
    (90, 0.41406249556672320),
    (91, 0.41796874064442990),
    (92, 0.42187500468826467),
    (93, 0.42578125979504544),
    (94, 0.42968749122124228),
    (95, 0.43359375233173553),
    (96, 0.43750000006232620),
    (97, 0.44140624903369974),
    (98, 0.44531250886336826),
    (99, 0.44921874536003864),
    (100, 0.45312499750647989),
    (101, 0.45703124826504848),
    (102, 0.46093749469545153),
    (103, 0.46484374855427874),
    (104, 0.46875000916190868),
    (105, 0.47265624546375790),
    (106, 0.47656250954251134),
    (107, 0.48046875156319935),
    (108, 0.48437499940355627),
    (109, 0.48828124370402004),
    (110, 0.49218749446233628),
    (111, 0.49609374741929602),
    (112, 0.49999999653692839),
    (113, 0.50390624874468193),
    (114, 0.50781249792640082),
    (115, 0.51171875080191132),
    (116, 0.51562499511539561),
    (117, 0.51953125645658549),
    (118, 0.52343749834406961),
    (119, 0.52734374818889174),
    (120, 0.53125000556513102),
    (121, 0.53515625336198269),
    (122, 0.53906250897089569),
    (123, 0.54296875182662174),
    (124, 0.54687500453339621),
    (125, 0.55078124448098631),
    (126, 0.55468749549265917),
    (127, 0.55859374227380354),
    (128, 0.56249999365960546),
    (129, 0.56640625217952301),
    (130, 0.57031250923201593),
    (131, 0.57421874394992334),
    (132, 0.57812500778226827),
    (133, 0.58203125697155045),
    (134, 0.58593749005464901),
    (135, 0.58984374726630240),
    (136, 0.59374999725756561),
    (137, 0.59765624954636476),
    (138, 0.60156249895690750),
    (139, 0.60546875785008214),
    (140, 0.60937499393612182),
    (141, 0.61328124946768381),
    (142, 0.61718750852241788),
    (143, 0.62109375737644246),
    (144, 0.62500000960457236),
    (145, 0.62890625860732696),
    (146, 0.63281250039144399),
    (147, 0.63671875596921523),
    (148, 0.64062500558900004),
    (149, 0.64453125998225869),
    (150, 0.64843750894990781),
    (151, 0.65234375265120204),
    (152, 0.65624999923190441),
    (153, 0.66015625086512608),
    (154, 0.66406250710989612),
    (155, 0.66796874423728669),
    (156, 0.67187500594958505),
    (157, 0.67578124269870599),
    (158, 0.67968749159500652),
    (159, 0.68359375010039258),
    (160, 0.68750000547024070),
    (161, 0.69140624761372860),
    (162, 0.69531250177379955),
    (163, 0.69921874742985191),
    (164, 0.70312500713206982),
    (165, 0.70703124015175012),
    (166, 0.71093749387635896),
    (167, 0.71484374317542632),
    (168, 0.71874999312375176),
    (169, 0.72265625056458871),
    (170, 0.72656249270450124),
    (171, 0.73046875856204030),
    (172, 0.73437499835808384),
    (173, 0.73828125400781208),
    (174, 0.74218750431207536),
    (175, 0.74609375840350878),
    (176, 0.75000000376167697),
    (177, 0.75390624250269600),
    (178, 0.75781250425562907),
    (179, 0.76171875237018127),
    (180, 0.76562500400318989),
    (181, 0.76953125814521162),
    (182, 0.77343749958182595),
    (183, 0.77734374538899753),
    (184, 0.78124999684567953),
    (185, 0.78515625783726140),
    (186, -0.0000000000000000),
    (187, 10680707.000000000),
    (188, 16069853.000000000),
    (189, 16666979.000000000),
    (190, 4345298.0000000000),
    (191, 16653803.000000000),
    (192, 3062596.0000000000),
    (193, 3772886.0000000000),
    (194, 12450088.000000000),
    (195, 15675153.000000000),
    (196, 2607881.0000000000),
    (197, 7677882.0000000000),
    (198, 9065106.0000000000),
    (199, 5636912.0000000000),
    (200, 10155062.000000000),
]

e0 = 0.3333333333332254
e1 = 0.13333354920669913


def get_correction(w):
    i = ((int) (-15.5 + 256 * w))
    return correction_values[i][1]


def get_z_from_w(w):
    return w - get_correction(w)

def get_fi_gi(w):
    i = ((int) (-15.5 + 256 * w))
    return f[i][1], g[i][1]



input_range = np.linspace(0.0608, np.pi/4, 1000)
fi_vals = []
gi_vals = []
res = []

for v in input_range:
    z = get_z_from_w(v)
    pz = z + z**3 * (e0 + z**2 * e1)

    fi, gi = get_fi_gi(v)
    fi_vals.append(fi)
    gi_vals.append(gi)

    t2 = pz * (gi + fi) / (gi - pz)
    res.append(t2)


fi_vals = np.array(fi_vals)
gi_vals = np.array(gi_vals)

lin_coeff = ((1/input_range[-1]) - fi_vals[-1]) / input_range[-1]
approx_gi = 1/input_range - lin_coeff * input_range

"""
print("Coeff GI: ", lin_coeff)
# plt.scatter(input_range, res, label="z values", s=0.5)
plt.plot(input_range, gi_vals, label="gi", lw=1)
plt.plot(input_range, approx_gi, label=f"approx gi = 1/x - {lin_coeff} * x", lw=1)

plt.xlabel("Tan Input")
plt.ylabel("gi")
plt.legend()
plt.savefig("../plots/glibc/approx_gi.png")
plt.show()
"""

approx_fi = 1.2 * input_range

# plt.scatter(input_range, res, label="z values", s=0.5)
plt.plot(input_range, fi_vals, label="fi", lw=1)
plt.plot(input_range, approx_fi, label=f"approx fi", lw=1)

plt.xlabel("Tan Input")
plt.ylabel("fi")
plt.legend()
plt.savefig("../plots/glibc/approx_fi.png")
plt.show()
