#include <assert.h>
#include <float.h>
#include <limits.h>
#include <math.h>

#include <stdio.h>
#include <stdlib.h>
#include "trig_simd.h"

#include <string.h>   // just used for the error calculation
#include "./util/bit_printing.h"


double CORRECTION = 0.00000000000000006123233995736765;
double M_PI_8 = M_PI / 8;

// Working until 0.4
double TAYLOR_COEFF_TAN[] = {
  1.0000000000000000,
  0.33333333333333331,
  0.13333333333333333,
  0.053968253968253971,
  0.021869488536155203,
  0.0088632355299021973,
  0.0035921280365724811,
  0.0014558343870513183,
  0.00059002744094558595,
  0.00023912911424355248,
  9.6915379569294509e-05,
  3.9278323883316833e-05,
  1.5918905069328964e-05,
  6.4516892156554306e-06
};


#define N_FIRST_MID 17

static const double X_FIRST_MID[17] = {
    0.39269908169872414,
    0.3974311529539063,
    0.4054030240311012,
    0.4286863854186324,
    0.4576011079513348,
    0.487426901464288,
    0.5407991673806207,
    0.5723175108611952,
    0.6115367603429416,
    0.6435891799153872,
    0.6768825409954158,
    0.7002130267439945,
    0.7267833123145859,
    0.7490809891502078,
    0.7665916163094255,
    0.7796607724399203,
    0.7853981633974483
};

static const double Y_FIRST_MID[17] = {
    0.41421356237309503,
    0.4197684582474178,
    0.42917669979674156,
    0.4570320684430114,
    0.4924645633683938,
    0.5300875167665825,
    0.6005164649453173,
    0.6442430603066724,
    0.7012087722833138,
    0.7501376202189168,
    0.8035182551172894,
    0.8426526043282521,
    0.8891412771435833,
    0.9298813332611141,
    0.9630769477832821,
    0.9885905533499666,
    1.0000000000000000
};


double intersec_lookup[256] = {
3.487868498008632e-16,
-5.488580222088102e-16,
3.885780586188048e-16,
-4.3351128072801554e-14,
-1.9388436586023467e-12,
-1.9316944554646483e-11,
-8.03568690090347e-11,
-2.1542698201157112e-10,
-4.4284721036385716e-10,
-7.721433128814851e-10,
-1.195224715425769e-09,
0.12698375298777156,
-1.7008998029393982e-09,
-2.278241818078463e-09,
-2.9112951162298496e-09,
-3.5887150227485096e-09,
-0.04250900369329121,
-4.2969822068603635e-09,
0.048454648979660585,
-5.027141907231308e-09,
-0.20871320054134335,
-5.771515340404646e-09,
-6.522778221311031e-09,
-7.275274970819947e-09,
-0.06721088444144684,
-8.023525696713005e-09,
3.154509986558196e-10,
-8.761429643840306e-09,
-9.493151374334734e-09,
3.690965311164973e-10,
-1.0213307755721482e-08,
-1.0919072740329219e-08,
-1.1654587428371195e-08,
-0.2502860640752247,
-1.228422239123599e-08,
-1.2947525085866773e-08,
-1.3591262776683526e-08,
-1.4220214054466845e-08,
-0.05039909270591449,
-0.050399092705914715,
-1.4830628582629743e-08,
-3.028246669472817,
-1.5423033183006076e-08,
-1.5996739328619753e-08,
0.542154787548828,
-1.655950050700295e-08,
0.7014535089194327,
-1.7111475964551644e-08,
6.447166134293525e-10,
-1.76405173463622e-08,
-0.2929007509695775,
-1.8159738275134745e-08,
6.82608747304414e-10,
-1.8669040162193673e-08,
0.38150197197638247,
-1.9152512883942414e-08,
-0.03320342129825407,
-1.962659306640008e-08,
-2.0083987392443248e-08,
0.03642521447243108,
-2.053167957199946e-08,
7.685595493356345e-10,
-2.09720154382459e-08,
7.843576899091431e-10,
-2.14167548338742e-08,
-2.1809652152797934e-08,
-2.2289341780886134e-08,
8.292699860135144e-10,
-2.259901128253334e-08,
-2.2987598034996656e-08,
-2.3362478651050525e-08,
-2.3721695147757007e-08,
-2.4073424155010913e-08,
0.5886032100459485,
-2.44222125662322e-08,
-2.4756732555975475e-08,
9.211444940149249e-10,
-2.5081365971629438e-08,
-2.5401168540000578e-08,
9.445066950775072e-10,
-2.5710820167091486e-08,
-2.6013403080435588e-08,
-2.630162742317313e-08,
9.774538956008882e-10,
-2.6604643402749166e-08,
-2.680811078113145e-08,
1.4264364293517926,
-2.7130894884416074e-08,
-0.059455867407424805,
-2.7423646607869768e-08,
1.017858575202979e-09,
-2.767346745859017e-08,
0.05949590226983455,
-2.793659865885482e-08,
1.0366879577006216e-09,
-2.818958314268682e-08,
1.0458329757767615e-09,
-2.8140303056326397e-08,
1.0546830075952585e-09,
-2.8668360857769217e-08,
-0.07039948610848774,
-2.8908894613017818e-08,
-2.905328930157446e-08,
1.0802176930724272e-09,
-2.9363672161854085e-08,
-0.4059701986797777,
-2.957662689294547e-08,
-0.03691596199807059,
-2.9797411143515275e-08,
-3.000632573762733e-08,
-3.011526567713257e-08,
-3.041263089253354e-08,
-3.062959597791692e-08,
0.04085062414895902,
-3.0797858866372724e-08,
4.356089146853417,
-3.1089632611456075e-08,
-3.118432438106141e-08,
1.154504047917726e-09,
-3.135848482501644e-08,
-3.154353554474154e-08,
-3.170585398877793e-08,
-0.04571321118325562,
-3.189055500818978e-08,
0.48579471321391077,
-3.202090455983464e-08,
1.1864225157864894e-09,
-3.218632430540082e-08,
0.04573853214200217,
-3.2262918515983364e-08,
-3.238869380443274e-08,
-3.2664790267767716e-08,
-3.287663512512876e-08,
0.051872253013366815,
-3.300518517525105e-08,
-0.05188057350663781,
-3.3155860801600136e-08,
-3.327748917467223e-08,
0.05189667901881602,
-3.341921869565042e-08,
-3.357564612970109e-08,
-3.37222408467314e-08,
-3.3672975555329374e-08,
-0.059915619160216836,
-3.395566192362431e-08,
0.059923882308714774,
-3.4442625461648556e-08,
0.05993197436869285,
-3.422210715587082e-08,
1.2662982884492635e-09,
-3.4339982583475935e-08,
-3.450885053322252e-08,
0.05995528911591979,
-3.462903886023736e-08,
1.2799408199981599e-09,
-3.46872799412988e-08,
-3.480291485728615e-08,
1.2886742783990712e-09,
-3.496490339036657e-08,
-3.4997292397883635e-08,
0.07089870763901283,
-3.531150293758185e-08,
-0.16955955035795486,
-3.510170097232309e-08,
1.3053214065195107e-09,
-3.54212755574048e-08,
-3.5426441718979136e-08,
-3.5662684109036584e-08,
-3.564576081461741e-08,
1.3209657812041087e-09,
-3.585346766052441e-08,
3.7165246418141327,
-3.571814934331001e-08,
1.3284399136281877e-09,
-3.604207861040388e-08,
-3.567805379116968e-08,
-3.611232739655647e-08,
-3.63463540926503e-08,
1.3427385869846375e-09,
-3.642090638153944e-08,
-0.6073793980718717,
-3.655341912637314e-08,
0.04110454864913891,
-3.665663536052635e-08,
-3.667825294116413e-08,
1.356234236027376e-09,
-3.683843099700773e-08,
-3.685349604824466e-08,
-0.04595618780764375,
-3.6958636981669585e-08,
0.18383993831290169,
-3.7112259229627073e-08,
-3.713937017208272e-08,
-3.720345111472779e-08,
1.3751080274460037e-09,
-3.7346806442219836e-08,
1.3781091823261704e-09,
-3.734071672557707e-08,
0.05210849633657548,
-3.736764989055718e-08,
-3.7534628457650583e-08,
0.208465061239971,
-3.763821624093188e-08,
-3.7675757593143984e-08,
1.3925161024275212e-09,
-3.7735635365612687e-08,
0.05212748970311702,
-3.7838341734604905e-08,
1.3980192559159832e-09,
-3.790523787207826e-08,
-0.16757581187468895,
-3.796456556516219e-08,
-3.800963974309828e-08,
1.4060161923623582e-09,
-3.812463950012324e-08,
0.3610047128926337,
-3.855289534707402e-08,
-3.835528114905067e-08,
-0.3610511425111029,
-3.798821417408479e-08,
-3.824628375376272e-08,
-3.8467317013980075e-08,
-3.853951406216269e-08,
-3.89788721881898e-08,
-3.873853703557706e-08,
-3.873324143283413e-08,
1.4306162920973975e-09,
-3.861962449076967e-08,
-3.888169809113566e-08,
-3.890867563134176e-08,
-3.896610750039611e-08,
-3.90636506646232e-08,
-3.91159842485083e-08,
-3.912994097142227e-08,
-3.920644325601871e-08,
-0.14913339003234202,
-3.924034105972849e-08,
1.450391140522811e-09,
-3.906859329626126e-08,
1.4524619285083418e-09,
-3.930284592820024e-08,
0.04121419787687313,
-3.943479492481192e-08,
-0.041216238117181676,
-3.947880294440573e-08,
-3.9537341329051804e-08,
-0.4534227558919581,
-3.955071887263917e-08,
-3.9635111349394086e-08,
1.4642487222715772e-09,
-4.735816150631433e-08,
0.23038107077204087,
-3.974380251719741e-08,
-3.9727942370722655e-08,
-3.9855873109705165e-08,
-3.981812348033903e-08};

double slope_lookup[256] = {
-3.005361419676914e-16,
2.664535259100442e-15,
0.0,
9.592326932761451e-14,
3.6637359812631434e-12,
3.35598215883689e-11,
1.326045939719983e-10,
3.431797068743093e-10,
6.87625956174956e-10,
1.1754797135666956e-09,
1.7915913197448236e-09,
-0.18181818181818182,
2.5178952256512694e-09,
3.33781002837068e-09,
4.228400740656195e-09,
5.173808048656851e-09,
0.058823529411764705,
6.155502774168922e-09,
-0.06666666666666667,
7.161531812022267e-09,
0.2857142857142857,
8.181811228527603e-09,
9.206799322926844e-09,
1.0229270763780306e-08,
0.09090909090909091,
1.124224713323991e-08,
0.0,
1.2237933333373019e-08,
1.3222335226760807e-08,
0.0,
1.4188543673289508e-08,
1.5133094777295263e-08,
1.6115198064951343e-08,
0.3333333333333333,
1.695409013177889e-08,
1.7836236487775157e-08,
1.8690822223287048e-08,
1.952438877247972e-08,
0.06666666666666667,
0.06666666666666667,
2.033213597493995e-08,
4.0,
2.1114914261517098e-08,
2.1871976230183928e-08,
-0.7142857142857143,
2.2613648287366942e-08,
-0.9230769230769231,
2.334023641036182e-08,
0.0,
2.4035853307747432e-08,
0.38461538461538464,
2.4717835778265522e-08,
0.0,
2.538611321165939e-08,
-0.5,
2.601990223297113e-08,
0.043478260869565216,
2.6640822881044926e-08,
2.7239384081970108e-08,
-0.047619047619047616,
2.782477848137972e-08,
0.0,
2.8400110263886816e-08,
0.0,
2.89807573494328e-08,
2.949336774809422e-08,
3.0118787464197357e-08,
0.0,
3.052224251109637e-08,
3.102826795508928e-08,
3.151615501923411e-08,
3.19833937110343e-08,
3.2440650166489e-08,
-0.7647058823529411,
3.289384764584539e-08,
3.332828946193797e-08,
0.0,
3.3749691041849104e-08,
3.4164631124384975e-08,
0.0,
3.4566225437354585e-08,
3.495848410759318e-08,
3.533197867645973e-08,
0.0,
3.57244793748609e-08,
3.598795927967646e-08,
-1.8461538461538463,
3.640577173106915e-08,
0.07692307692307693,
3.678456339562207e-08,
0.0,
3.7107696915479787e-08,
-0.07692307692307693,
3.7447932755141404e-08,
0.0,
3.7774938733131784e-08,
0.0,
3.7711347378579424e-08,
0.0,
3.839352036340683e-08,
0.09090909090909091,
3.870415188339481e-08,
3.889059474514855e-08,
0.0,
3.9291210286331036e-08,
0.5238095238095238,
3.956599714615398e-08,
0.047619047619047616,
3.9850810651923874e-08,
4.012024312717708e-08,
4.026071254126379e-08,
4.064405478853073e-08,
4.092366445875125e-08,
-0.05263157894736842,
4.1140462592707624e-08,
-5.611111111111111,
4.151629839983743e-08,
4.163824485280766e-08,
0.0,
4.186249569224551e-08,
4.2100722907492615e-08,
4.230964378965834e-08,
0.058823529411764705,
4.254732655204344e-08,
-0.625,
4.2715036841748124e-08,
0.0,
4.292783462211287e-08,
-0.058823529411764705,
4.302635581135858e-08,
4.318813573414941e-08,
4.3543121109140325e-08,
4.381544904695021e-08,
-0.06666666666666667,
4.3980659116057916e-08,
0.06666666666666667,
4.417428423061642e-08,
4.433055789248307e-08,
-0.06666666666666667,
4.4512633578883494e-08,
4.471355952183028e-08,
4.490182670105573e-08,
4.483858617851768e-08,
0.07692307692307693,
4.520153851437053e-08,
-0.07692307692307693,
4.58266238294712e-08,
-0.07692307692307693,
4.5543564921405346e-08,
0.0,
4.56948479048805e-08,
4.59115412374112e-08,
-0.07692307692307693,
4.606574588490565e-08,
0.0,
4.6140463450310614e-08,
4.6288802125846214e-08,
0.0,
4.649656659694318e-08,
4.653811336499969e-08,
-0.09090909090909091,
4.6941015077329864e-08,
0.21739130434782608,
4.667201825082928e-08,
0.0,
4.708173051470356e-08,
4.7088362098938134e-08,
4.739115766558141e-08,
4.736946835112884e-08,
0.0,
4.763564121138911e-08,
-4.761904761904762,
4.746226212348508e-08,
0.0,
4.7877295460354496e-08,
4.741097292664833e-08,
4.796730212813972e-08,
4.826705036187492e-08,
0.0,
4.836252776286244e-08,
0.7777777777777778,
4.853221824711452e-08,
-0.05263157894736842,
4.8664379192886465e-08,
4.869205261481349e-08,
0.0,
4.889711968563439e-08,
4.891640159851806e-08,
0.058823529411764705,
4.905098550013791e-08,
-0.23529411764705882,
4.9247605990963726e-08,
4.928229824441607e-08,
4.93643028706564e-08,
0.0,
4.9547736582471097e-08,
0.0,
4.9539945482837564e-08,
-0.06666666666666667,
4.957441124157405e-08,
4.9788032366306504e-08,
-0.26666666666666666,
4.992054236560283e-08,
4.996856129153088e-08,
0.0,
5.004514803106359e-08,
-0.06666666666666667,
5.0176502955513516e-08,
0.0,
5.0262054076939094e-08,
0.21428571428571427,
5.033792183035611e-08,
5.039555972866254e-08,
0.0,
5.054259677605325e-08,
-0.46153846153846156,
5.10901188012499e-08,
5.0837460910872856e-08,
0.46153846153846156,
5.036822648067744e-08,
5.069813368897238e-08,
5.098065969452787e-08,
5.1072934770501326e-08,
5.163442340383667e-08,
5.132727576374026e-08,
5.132050606937174e-08,
0.0,
5.117533064062981e-08,
5.151019610395098e-08,
5.154466364860967e-08,
5.161803784911537e-08,
5.174265016026638e-08,
5.1809501134339414e-08,
5.1827329098740656e-08,
5.19250455974646e-08,
0.19047619047619047,
5.1968342970056915e-08,
0.0,
5.174900375570674e-08,
0.0,
5.204817910568948e-08,
-0.05263157894736842,
5.2216684313697714e-08,
0.05263157894736842,
5.22728820243027e-08,
5.234763023475274e-08,
0.5789473684210527,
5.2364713457743266e-08,
5.247246637674363e-08,
0.0,
6.233238592331352e-08,
-0.29411764705882354,
5.261123403481911e-08,
5.259098756423443e-08,
5.2754302261667325e-08,
5.2706119472794545e-08};

static double LAGRANGE_DEN_FIRST_MID[N_FIRST_MID][N_FIRST_MID];

void init_first_mid_lagrange_table(void)
{
    for (size_t i = 0; i < N_FIRST_MID; ++i) {
        for (size_t j = 0; j < N_FIRST_MID; ++j) {
            if (i == j) {
                LAGRANGE_DEN_FIRST_MID[i][j] = 0.0;
            } else {
                LAGRANGE_DEN_FIRST_MID[i][j] = 1.0 / (X_FIRST_MID[i] - X_FIRST_MID[j]);
            }
        }
    }
}

void start_of_range(double input, double *res) {
    double taylor = input;
    double x_square = taylor * taylor;
    double result = TAYLOR_COEFF_TAN[13];

    for (int j = 12; j >= 0; j-=1) {
      double coeff = TAYLOR_COEFF_TAN[j];
      result = result * x_square + coeff;
    }

    *res = result * taylor;

}

void end_of_range(double input, double *res) {
    double from_behind = M_PI_2 - input;
    double x_square = from_behind * from_behind;

    TAYLOR_COEFF_TAN[0] += CORRECTION * 1/from_behind;
    double result = TAYLOR_COEFF_TAN[13];

    for (int j = 12; j >= 0; j-=1) {
      double coeff = TAYLOR_COEFF_TAN[j];
      result = result * x_square + coeff;
    }

    result = result * from_behind;
    *res = 1 / result;
    TAYLOR_COEFF_TAN[0] = 1.0;
}

void first_mid_range(double input, double *res) {
    double result = 0.0;

    for (size_t i = 0; i < N_FIRST_MID; ++i) {
        double Li = 1.0;

        for (size_t j = 0; j < N_FIRST_MID; ++j) {
            if (j == i) continue;
            Li *= (input - X_FIRST_MID[j]) * LAGRANGE_DEN_FIRST_MID[i][j];
        }

        result += Y_FIRST_MID[i] * Li;
    }

    *res = result;
}

void sec_mid_range(double input, double *res) {
    double result = 0.0;
    double from_end = M_PI_2 - input;

    for (size_t i = 0; i < N_FIRST_MID; ++i) {
        double Li = 1.0;

        for (size_t j = 0; j < N_FIRST_MID; ++j) {
            if (j == i) continue;
            Li *= (from_end - X_FIRST_MID[j]) * LAGRANGE_DEN_FIRST_MID[i][j];
        }

        result += Y_FIRST_MID[i] * Li;
    }

    *res = 1/result;
}


void tan_simd(double *input, double *res, size_t n, int prec) {
  int simd_doubles = 4;
  // init_first_mid_lagrange_table();

  const SDOUBLE one_over_pi_8 = LOAD_DOUBLE(1/M_PI_8);
  const SDOUBLE m_pi_2 = LOAD_DOUBLE(M_PI_2);
  const SDOUBLE index_sum = LOAD_DOUBLE(M_PI_4+1.0/255.0);
  const SDOUBLE correction = LOAD_DOUBLE(CORRECTION);

  int last_taylor_coeff = 10;
  int taylor_loop_iteration = last_taylor_coeff - 1;
  double test_lookup[2] = {0.0, 0.1};

  const SDOUBLE half = LOAD_DOUBLE(0.5);
  const SDOUBLE one = LOAD_DOUBLE(1.0);
  const SDOUBLE two = LOAD_DOUBLE(2.0);
  
  for (int i = 0; i < (int) n; i += 4) {
    SDOUBLE x   = LOAD_DOUBLE_VEC(&input[i]);

    SDOUBLE from_behind = SUB_DOUBLE_S(m_pi_2, x);

    const SDOUBLE not_floored = MUL_DOUBLE_S(x, one_over_pi_8);
    const SDOUBLE quadrant = FLOOR_DOUBLE_S(not_floored);

    SDOUBLE in_q0 = SUB_DOUBLE_S(quadrant, two);
    in_q0 = ABS_PD(in_q0);
    in_q0 = MUL_DOUBLE_S(in_q0, half);
    in_q0 = FLOOR_DOUBLE_S(in_q0);

 
    SDOUBLE bot = SUB_DOUBLE_S(index_sum, x);
    SDOUBLE idouble = DIV_DOUBLE_S(one, bot);
    __m128i idx = _mm256_cvttpd_epi32(idouble);   

    SDOUBLE slope = _mm256_i32gather_pd(slope_lookup, idx, 8);
    SDOUBLE intersec = _mm256_i32gather_pd(intersec_lookup, idx, 8);

    x = FMADD_PD(x, slope, intersec);


    // __m128i idx = _mm256_cvttpd_epi32(in_q0);   
    // SDOUBLE out_q1 = _mm256_i32gather_pd(test_lookup, idx, 8);
    // x = ADD_DOUBLE_S(x, out_q1);
    

    SDOUBLE in_q1 = SUB_DOUBLE_S(quadrant, one);
    in_q1 = ABS_PD(in_q1);
    in_q1 = MUL_DOUBLE_S(in_q1, half);
    in_q1 = FLOOR_DOUBLE_S(in_q1);

    
    /* ---- Calculation for first range ---- */
    const SDOUBLE x_square = MUL_DOUBLE_S(x, x);
    SDOUBLE result_q0 = LOAD_DOUBLE(TAYLOR_COEFF_TAN[last_taylor_coeff]);

    for (int j = taylor_loop_iteration; j >= 0; j-=1) {
      SDOUBLE coeff = LOAD_DOUBLE(TAYLOR_COEFF_TAN[j]);
      result_q0 = FMADD_PD(result_q0, x_square, coeff);
    }

    result_q0 = MUL_DOUBLE_S(result_q0, x);


    /* ---- Calculation for fourth range ---- */
    SDOUBLE from_behind_square = MUL_DOUBLE_S(from_behind, from_behind);

    // Calculation of the correction term
    SDOUBLE one_over_from_behind = DIV_DOUBLE_S(one, from_behind);
    SDOUBLE correction_term = MUL_DOUBLE_S(correction, one_over_from_behind);
    SDOUBLE first_coeff = ADD_DOUBLE_S(one, correction_term);

    SDOUBLE result_q3 = LOAD_DOUBLE(TAYLOR_COEFF_TAN[last_taylor_coeff]);

    // Important that first term is treated with correction
    for (int j = taylor_loop_iteration; j >= 1; j-=1) {
      SDOUBLE coeff = LOAD_DOUBLE(TAYLOR_COEFF_TAN[j]);
      result_q3 = FMADD_PD(result_q3, from_behind_square, coeff);
    }

    // add the corrected first coefficiant
    result_q3 = FMADD_PD(result_q3, from_behind_square, first_coeff);
    result_q3 = MUL_DOUBLE_S(result_q3, from_behind);
    result_q3 = DIV_DOUBLE_S(one, result_q3);


    /* ---- Final Addup ---- */


    /*
    PRINT_M256D(result_q0);
    PRINT_M256D(result_q1);
    PRINT_M256D(result_q2);
    PRINT_M256D(result_q3);
    */

    SDOUBLE result = LOAD_DOUBLE(0.0);
    result = FMADD_PD(result_q0, in_q0, result);
    result = FMADD_PD(result_q0, in_q1, result);
    result = FMADD_PD(result_q3, in_q1, result);


    SIMD_TO_DOUBLE_VEC(&res[i], result);

  }

  int num_left_over = (n % 4);

  for (size_t i = n - num_left_over; i < (int)n; i++) {
    if (input[i] < M_PI_8) {
      start_of_range(input[i], &res[i]);

    } else if (input[i] < 2 * M_PI_8) {
      first_mid_range(input[i], &res[i]);

    } else if (input[i] < 3 * M_PI_8) {
      sec_mid_range(input[i], &res[i]);

    } else if (input[i] > 3 * M_PI_8){
      end_of_range(input[i], &res[i]);
    }
  }

  for (int i = 0; i < n; i++) {
      if (isnan(res[i])) {
        printf("NaN at index %d, input = %.17g\n", i, input[i]);
      }
  }

}


// gcc ./cmeasure/cbind_to_hw_thread.c ./cmeasure/cmeasure.c ./cmeasure/CrystalClockInC.c ./trig_simd.c ./tests/test_interface_tan.c ./tests/value_generation.c ./tests/trig_arb_comparison.c ./util/bit_printing.c ./tan.c -o test -lm -mavx -mavx2 -mfma -O2 -lflint -Wextra && ./test 10000000 0 1.570796326794896 10000000
//
// Compilation and run on laptop
//
//
// gcc ./cmeasure/cbind_to_hw_thread.c ./cmeasure/cmeasure.c ./cmeasure/CrystalClockInC.c ./trig_simd.c ./tests/test_interface_tan.c ./tests/value_generation.c ./tests/trig_arb_comparison.c ./util/bit_printing.c ./tan.c -o test -lm -mavx -mavx2 -mfma -O2 $(pkg-config --cflags --libs flint) -Wextra && ./test 10000000 0 1.570796326794896 10000000
//
